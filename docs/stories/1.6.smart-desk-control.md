# Story 1.6: Smart Desk Control

## Status
**Research & Planning**

---

## Story

**As a** user with a standing desk,  
**I want** to control my desk height with voice commands like "Arvis, raise the desk" or "Arvis, set desk to standing height",  
**so that** I can adjust my workspace ergonomically without leaving my chair.

---

## Acceptance Criteria

1. Smart desk controller integrated with Arvis
2. Voice commands control desk height (up/down/position presets)
3. Desk height presets configured (sitting, standing, custom)
4. Safety features prevent desk movement when obstructed
5. Status queries work ("Arvis, what's the desk height?")
6. Integration with existing posture detection (desk zone awareness)
7. Local network control (no cloud dependency)

---

## Recommended Smart Desk Options

### Option 1: Autonomous Smart Desk (Recommended)
- **Price**: ~$800-1200
- **API**: Full REST API + MQTT support
- **Features**: Height presets, collision detection, app control
- **Integration**: Direct HTTP/MQTT control from Arvis
- **Pros**: Purpose-built for automation, reliable API
- **Website**: autonomous.ai

### Option 2: Linak Controller + Manual Desk
- **Price**: ~$200-300 (controller) + desk
- **API**: Serial/USB interface, programmable
- **Features**: Precise height control, industrial quality
- **Integration**: Direct serial control from Pi GPIO
- **Pros**: Very reliable, full control
- **Cons**: More technical setup

### Option 3: Jarvis Standing Desk (with API access)
- **Price**: ~$1000-2000
- **API**: Limited, may require reverse engineering
- **Features**: Smooth operation, app control
- **Integration**: Possible via Bluetooth/serial bridge
- **Pros**: Premium build quality
- **Cons**: API access uncertain

---

## Integration Approach

### Controller Architecture
```python
class SmartDeskController:
    async def move_to_height(self, height_cm: float) -> bool
    async def move_up(self, distance_cm: float = 5.0) -> bool
    async def move_down(self, distance_cm: float = 5.0) -> bool
    async def get_current_height(self) -> Optional[float]
    async def stop_movement(self) -> bool
    async def set_preset(self, preset_name: str) -> bool
```

### Voice Commands
- "Arvis, raise the desk" → move up 5cm
- "Arvis, lower the desk" → move down 5cm
- "Arvis, set desk to standing height" → move to preset
- "Arvis, desk to sitting position" → move to preset
- "Arvis, stop the desk" → emergency stop
- "Arvis, what's the desk height?" → report current height

### Safety Features
- Collision detection integration
- Emergency stop commands
- Movement limits
- Obstruction warnings

### Scene Integration
- Welcome scene: Set to preferred height
- Focus scene: Set to standing height
- Sleep scene: Set to sitting height (if needed)

---

## Implementation Plan

### Phase 1: Basic Control
- Install desk controller
- Implement basic up/down/height control
- Add voice commands for movement
- Safety features

### Phase 2: Preset Management
- Configure height presets
- Voice commands for presets
- Integration with scenes

### Phase 3: Advanced Features
- Height tracking and logging
- Ergonomic reminders
- Posture-based automatic adjustments

---

## Dependencies

### Hardware
- Smart desk controller (Autonomous recommended)
- Desk with compatible motor system

### Software
- `requests` for HTTP API control (Autonomous)
- `paho-mqtt` for MQTT control (optional)
- `pyserial` for serial control (Linak)

---

## Testing

- Manual control verification
- Voice command integration
- Safety feature testing
- Scene integration testing

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-01-XX | 1.0 | Initial smart desk research and story | Arman |

